histdb-frecent-dirs () {
    _histdb_init
    local now="$(date +%s)"
    _histdb_query -separator "\n" \
                  "
select places.dir
from history left join places on history.place_id = places.rowid
where places.host = ${HISTDB_HOST}
and places.dir != '$(sql_escape $PWD)'
and places.dir like '%$(sql_escape ${1:-${PWD}})%'
group by places.dir
order by sum(1000.0/($now - history.start_time)) desc
limit 100
" | while read d; do
        ( [[ $d = "/net/*" ]] || [[ -d $d ]] ) && echo $d
    done
}

_my_files () {
    _named_directories
    values=(${(f)"$(histdb-frecent-dirs $PREFIX)"})
    local expl
    _tags recent-directories
    _requested -V recent-directories expl 'recent directory' compadd -U -a values
}